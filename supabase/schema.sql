-- 1. 입원 세션 (퇴원 시 status 변경으로 접근 차단)
CREATE TABLE admissions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    patient_name_masked TEXT NOT NULL,         -- 예: 이*원 (마스킹 필수)
    room_number INTEGER NOT NULL,
    access_token UUID DEFAULT gen_random_uuid() UNIQUE, -- QR 접속용 토큰
    status TEXT DEFAULT 'IN_PROGRESS',         -- IN_PROGRESS / DISCHARGED
    check_in_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    discharged_at TIMESTAMP WITH TIME ZONE
);

-- 2. 바이탈 사인 (시계열 데이터, 그래프용)
CREATE TABLE vital_signs (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    admission_id UUID REFERENCES admissions(id),
    temperature NUMERIC(3, 1) NOT NULL,
    has_medication BOOLEAN DEFAULT FALSE,      -- 해열제 투약 여부 마커
    recorded_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 3. 수액 기록 (증거 남기기용)
CREATE TABLE iv_records (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    admission_id UUID REFERENCES admissions(id),
    photo_url TEXT,                            -- 수액 조절기 촬영 사진 URL
    drops_per_min INTEGER,                     -- gtt 속도
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 4. 식단/서류 요청
CREATE TABLE meal_requests (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    admission_id UUID REFERENCES admissions(id),
    request_type TEXT,                         -- GENERAL, SOFT, NPO(금식)
    status TEXT DEFAULT 'PENDING'
);

-- 5. 감사 로그 (필수 보안)
CREATE TABLE audit_logs (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    actor_type TEXT,                           -- NURSE, GUARDIAN
    action TEXT,                               -- VIEW, CREATE, UPDATE
    target_id UUID,
    ip_address TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
