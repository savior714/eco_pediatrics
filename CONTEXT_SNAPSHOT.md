# Context Snapshot

## 작업 이어가기 (다음에 열었을 때)

1. **로컬 실행**: `easy_start.bat` 또는 백엔드(`uvicorn backend.main:app`), 프론트(`npm run dev` in frontend).
2. **검사 일정 연동 확인용 더미**: 백엔드 실행 후 **한 번** 호출  
   `POST http://localhost:8000/api/v1/seed/station-admissions`  
   → 스테이션 30병상에 해당하는 입원 더미 생성. 스테이션 새로고침 후 검사 일정 추가·보호자 대시보드 연동 테스트 가능.
3. **이어서 할 작업**: [NEXT_STEPS.md](./NEXT_STEPS.md) 참고 (환자별 히스토리, IV 사진 모바일, 교육 영상 등).
4. **문제 발생 시**: [TROUBLESHOOTING.md](./TROUBLESHOOTING.md) §7(검사 일정/입원 연동), §6(pyiceberg) 등 참고.

---

## 현재 상태 (2026-02-13)

- 보호자 대시보드(Guardian Dashboard) 핵심 기능 구현 완료, **모바일(QR 접속) 우선** 적용
- 간호 스테이션(Nurse Station) MVP 구현 완료 (환자 패널 클릭 → 상세 모달, IV·체온 차트·요청·**예정된 검사** 포함)
- 백엔드 API 및 실시간 웹소켓 연동 완료
- DB 스키마: 식단, 서류, 수액, **검사 일정(exam_schedules)**, 감사 로그

## 주요 설계 결정

- **수액 단위**: 모든 수액 주입 속도는 `cc/hr` 단위 사용 (임상 현장 맞춤)
- **보호자 대시보드**: 모바일 우선(스마트폰 QR 접속), safe-area·터치 영역 44px 이상, 모달 바텀시트 스타일
- **검사 일정**: 스테이션에서만 추가 가능. 항목은 고정 8종(흉부/복부 X-Ray, 초음파, 소변/대변/혈액검사, PCR, 신속항원). 시간은 오전/오후만 선택.
- **보안**: 토큰 기반 대시보드 접근 제어, RLS 및 감사 로그

## 완료된 주요 작업

- [x] 식단 신청 모달 및 백엔드 연동
- [x] **현재 신청 식단 표시 + 변경 버튼** (대시보드 API meals 연동)
- [x] 실시간 체온 그래프 (38° 기준 구간별 색상·보간점·애니메이션 off)
- [x] 다중 서류 신청 기능 (5종 서류)
- [x] 수액 단위 cc/hr, IVRecordCreate 정합성, 사진 선택 입력
- [x] 글로벌 에러 핸들링 및 404 페이지
- [x] 간호 스테이션: 그리드 패널 클릭 → 상세 모달(체온 차트 + IV + 요청), 프린터 버튼 제거
- [x] **예정된 검사 일정**: 스테이션 환자 모달에서 목록 표시·추가(8종 선택, 오전/오후), API·DB 연동. 보호자 대시보드 "앞으로의 검사 일정"에 동일 데이터 표시
- [x] **스테이션–입원 연동**: `GET /api/v1/admissions`로 병상별 실제 admission_id 사용. 개발용 `POST /api/v1/seed/station-admissions`로 30병상 더미 입원 생성
- [x] easy_start.bat: 스크립트 경로 고정, venv, 프론트 npm install, supabase 2.25.0 고정
- [x] Next.js 14.2.35 보안 패치, .env.example 추가
- [x] TemperatureGraph 타입 에러 수정 (Recharts dot null 반환 이슈)
- [x] **UI/UX 개선**: 스테이션/대시보드 로고 적용, 레이아웃 정리, 모바일 뷰 토글 위치 변경
- [x] **체온 차트 고도화**: 끊기는 선 대신 그라데이션 적용(38도 기준), 약물 아이콘(A/I/M) 정상 표시
- [x] **통합 테스트 데이터 생성**: `/api/v1/seed/full-test-data` (입원+체온기록+검사일정 한번에 생성)
- [x] **검사 일정 동기화 수정**: 삭제 시 실시간 반영 안되던 버그 수정 (웹소켓 브로드캐스트 타겟팅 보완)
