"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[135],{52099:function(e,t,a){a.d(t,{Z:function(){return l}});var r=a(57437);a(2265);var n=a(61994),i=a(53335);function l(e){let{children:t,className:a,...l}=e;return(0,r.jsx)("div",{className:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,i.m6)((0,n.W)(t))}("bg-white rounded-2xl shadow-sm border border-slate-200/80 p-4",a),...l,children:t})}},10425:function(e,t,a){a.d(t,{X:function(){return _}});var r=a(57437),n=a(2265),i=a(47625),l=a(87549),s=a(56940),o=a(97059),c=a(62994),d=a(84962),u=a(8147),m=a(54061),h=a(52099),f=a(26899),x=a(61994),p=a(53335),g=a(68057);function b(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,p.m6)((0,x.W)(t))}let _=n.memo(function(e){let{data:t,checkInAt:a,className:x}=e,{chartData:p,totalWidthPercent:_,gridTicks:w,labelTicks:y,yDomain:v}=(0,n.useMemo)(()=>{if(!a||0===t.length)return{chartData:t,totalWidthPercent:100,gridTicks:[],labelTicks:[],yDomain:[35.5,41]};let e=new Date(a),r=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime(),n=t.filter(e=>new Date(e.recorded_at).getTime()>=r).map(e=>{let t=new Date(e.recorded_at),r=t.getTime();return{...e,hospitalDay:(0,g.nK)(a,t),timestamp:r}}).sort((e,t)=>e.timestamp-t.timestamp),i=35.5,l=41;if(t.length>0){let e=t.map(e=>e.temperature),a=Math.min(...e),r=Math.max(...e);a<35.5&&(i=Math.floor(10*a)/10-.5),r>41&&(l=Math.ceil(10*r)/10+.5)}let s=n[n.length-1],o=Math.max(5,Math.ceil(((s?s.timestamp:Date.now())-r)/864e5)),c=[];for(let e=0;e<=o;e++)c.push(r+864e5*e);let d=[];for(let e=0;e<o;e++){let t=r+864e5*e+432e5;d.push(t)}return{chartData:n,totalWidthPercent:Math.max(100,20*o),gridTicks:c,labelTicks:d,yDomain:[i,l]}},[t,a]),k=n.useId(),N="tempColor-".concat(k.replace(/:/g,"")),S=t.length>0?t[0].temperature:null,D=(0,n.useMemo)(()=>{if(0===p.length)return 0;let e=p.map(e=>e.temperature),t=Math.max(...e),a=Math.min(...e);return t<=38?0:a>=38?1:(t-38)/(t-a)},[p]);return(0,r.jsxs)(h.Z,{className:b("w-full relative overflow-hidden border-slate-200/80",x),children:[(0,r.jsxs)("div",{className:"flex justify-between items-center gap-3 pb-3 bg-white z-10 relative",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,r.jsx)("span",{className:"w-9 h-9 bg-orange-50 text-orange-500 rounded-xl flex items-center justify-center shrink-0 border border-orange-100/50",children:(0,r.jsx)(f.Z,{size:18})}),(0,r.jsx)("h3",{className:"text-base font-bold text-slate-800",children:"체온 차트"})]}),(0,r.jsx)("div",{className:"text-right",children:(0,r.jsxs)("span",{className:b("text-3xl font-bold drop-shadow-sm",S&&S>=38?"text-status-danger":"text-slate-800"),children:[null!=S?S:"--","\xb0C"]})})]}),(0,r.jsx)("div",{className:"overflow-x-auto w-full touch-pan-x",style:{WebkitOverflowScrolling:"touch"},children:(0,r.jsx)("div",{className:"h-[260px] sm:h-[320px]",style:{width:"".concat(_,"%"),minWidth:"100%"},children:(0,r.jsx)(i.h,{width:"100%",height:"100%",children:(0,r.jsxs)(l.w,{data:p,margin:{top:10,right:20,left:0,bottom:0},children:[(0,r.jsx)(s.q,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),(0,r.jsx)("defs",{children:(0,r.jsxs)("linearGradient",{id:N,x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,r.jsx)("stop",{offset:0,stopColor:"#ef4444"}),(0,r.jsx)("stop",{offset:D,stopColor:"#ef4444"}),(0,r.jsx)("stop",{offset:D,stopColor:"#14b8a6"}),(0,r.jsx)("stop",{offset:1,stopColor:"#14b8a6"})]})}),(0,r.jsx)(o.K,{dataKey:"timestamp",type:"number",domain:[w[0],w[w.length-1]],scale:"time",ticks:y,tickFormatter:e=>a?"".concat((0,g.nK)(a,new Date(e)),"일차"):"",stroke:"#94a3b8",fontSize:12,tickLine:!1,axisLine:!1,tick:{dy:10},padding:{left:0,right:0}}),(0,r.jsx)(c.B,{domain:v,stroke:"#94a3b8",fontSize:11,tickLine:!1,axisLine:!1,width:30,ticks:[36,37,38,39,40,41]}),(0,r.jsx)(d.d,{y:38,stroke:"#ef4444",strokeDasharray:"3 3",label:{position:"right",value:"38\xb0",fill:"#ef4444",fontSize:10}}),(0,r.jsx)(u.u,{content:e=>{var t,a;let{active:n,payload:i,label:l}=e;if(!n||!(null==i?void 0:i.length)||!(null===(t=i[0])||void 0===t?void 0:t.payload))return null;let s=i[0].payload;return(0,r.jsxs)("div",{className:"rounded-xl border-none shadow-lg bg-white/95 px-3 py-2",children:[(0,r.jsx)("p",{className:"text-xs text-slate-500 mb-0.5",children:null!=l&&new Date(l).toLocaleString("ko-KR",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,r.jsxs)("p",{className:"text-slate-800 font-semibold",children:["체온 ",null===(a=s.temperature)||void 0===a?void 0:a.toFixed(1),"\xb0C"]})]})}}),w.map((e,t)=>(0,r.jsx)(d.d,{x:e,stroke:"#e2e8f0",strokeDasharray:"3 3"},t)),(0,r.jsx)(m.x,{type:"monotone",dataKey:"temperature",stroke:"url(#".concat(N,")"),strokeWidth:3,dot:e=>{let{cx:t,cy:a,payload:n}=e,i=n.temperature>=38;return(0,r.jsx)("circle",{cx:t,cy:a,r:4,fill:"#fff",stroke:i?"#ef4444":"#14b8a6",strokeWidth:2},"dot-".concat(n.recorded_at))},activeDot:e=>{let{cx:t,cy:a,payload:n}=e,i=n.temperature>=38;return(0,r.jsx)("circle",{cx:t,cy:a,r:6,fill:i?"#ef4444":"#14b8a6",stroke:"#fff",strokeWidth:2})},connectNulls:!0,isAnimationActive:!1}),(0,r.jsx)(m.x,{data:p,dataKey:e=>e.has_medication?40.7:null,stroke:"none",isAnimationActive:!1,dot:e=>{let{cx:t,cy:a,payload:n,index:i}=e;if(!n.has_medication)return(0,r.jsx)("path",{d:""});let l=n.medication_type||"M",s="A"===l?"#fb923c":"#8b5cf6",o=a+(i%2==0?0:15),c=e.yAxis.scale(n.temperature);return(0,r.jsxs)("g",{children:[(0,r.jsx)("line",{x1:t,y1:o+10,x2:t,y2:c,stroke:s,strokeDasharray:"2 2",strokeOpacity:.3}),(0,r.jsxs)("g",{transform:"translate(".concat(t-8,", ").concat(o-10,")"),children:[(0,r.jsx)("rect",{width:"16",height:"16",rx:"4",fill:s,stroke:"white",strokeWidth:"1"}),(0,r.jsx)("text",{x:"8",y:"12",textAnchor:"middle",fill:"white",fontSize:"10",fontWeight:"bold",children:l})]})]},"med-".concat(n.recorded_at))}})]})})})}),_>100&&(0,r.jsx)("div",{className:"absolute bottom-2 right-2 text-[10px] text-slate-400 bg-white/80 px-2 py-1 rounded-full pointer-events-none",children:"← 좌우로 스크롤 →"})]})},function(e,t){if(e.checkInAt!==t.checkInAt||e.className!==t.className)return!1;if(e.data===t.data)return!0;if(e.data.length!==t.data.length)return!1;let a=e.data[0],r=t.data[0],n=e.data[e.data.length-1],i=t.data[t.data.length-1];return(null==a?void 0:a.recorded_at)===(null==r?void 0:r.recorded_at)&&(null==n?void 0:n.recorded_at)===(null==i?void 0:i.recorded_at)&&(null==a?void 0:a.temperature)===(null==r?void 0:r.temperature)&&JSON.stringify(e.data)===JSON.stringify(t.data)})},98702:function(e,t,a){a.d(t,{u:function(){return c}});var r=a(57437),n=a(2265),i=a(32489),l=a(61994),s=a(53335);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,l.W)(t))}function c(e){let{isOpen:t,onClose:a,title:l,children:s,className:c}=e,[d,u]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{if(t)u(!0),document.body.style.overflow="hidden";else{let e=setTimeout(()=>u(!1),300);return document.body.style.overflow="unset",()=>clearTimeout(e)}},[t]),d||t)?(0,r.jsxs)("div",{className:o("fixed inset-0 z-50 flex items-end sm:items-center justify-center px-0 sm:px-4 transition-opacity duration-300","pt-[env(safe-area-inset-top)] pb-[env(safe-area-inset-bottom)]",t?"opacity-100":"opacity-0 pointer-events-none"),children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:a,"aria-hidden":!0}),(0,r.jsxs)("div",{className:o("bg-white rounded-t-2xl sm:rounded-2xl shadow-xl w-full max-w-sm max-h-[90dvh] overflow-hidden relative z-10 transform transition-all duration-300",t?"scale-100 translate-y-0":"scale-95 translate-y-4",c),children:[l&&(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-100 shrink-0",children:[(0,r.jsx)("h3",{className:"font-bold text-lg text-slate-800",children:l}),(0,r.jsx)("button",{onClick:a,className:"min-h-[44px] min-w-[44px] flex items-center justify-center rounded-full active:bg-slate-100 text-slate-400 touch-manipulation -mr-2","aria-label":"닫기",children:(0,r.jsx)(i.Z,{size:22})})]}),(0,r.jsx)("div",{className:"p-4 overflow-y-auto max-h-[calc(90dvh-4rem)]",children:s})]})]}):null}},68934:function(e,t,a){a.d(t,{y:function(){return l}});var r=a(2265),n=a(33795),i=a(71837);function l(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],[a,l]=(0,r.useState)([]),[s,o]=(0,r.useState)(null),[c,d]=(0,r.useState)([]),[u,m]=(0,r.useState)([]),[h,f]=(0,r.useState)([]),[x,p]=(0,r.useState)([]),[g,b]=(0,r.useState)(null),[_,w]=(0,r.useState)(null),[y,v]=(0,r.useState)(null),[k,N]=(0,r.useState)(null),[S,D]=(0,r.useState)(null),[j,E]=(0,r.useState)(!1),T=(0,r.useRef)(0),A=(0,r.useCallback)(async()=>{if(!e)return;let t=++T.current;E(!0);try{let a=await i.h.get("/api/v1/dashboard/".concat(e),{headers:{"X-Admission-Token":e}});if(t!==T.current)return;if(a){if(a.admission&&(b(a.admission.id),w(a.admission.display_name||a.admission.patient_name_masked||"환자"),v(a.admission.room_number),o(a.admission.check_in_at),N(a.admission.dob||null),D(a.admission.gender||null)),a.vitals&&Array.isArray(a.vitals)){let e=a.vitals.map(e=>({time:new Date(e.recorded_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),temperature:e.temperature,has_medication:e.has_medication,medication_type:e.medication_type,recorded_at:e.recorded_at}));l(e)}else l([]);d(a.meals||[]),m(a.document_requests||[]),f(a.iv_records||[]),p(a.exam_schedules||[])}}catch(e){t===T.current&&console.error(e)}finally{t===T.current&&E(!1)}},[e]),C=(0,r.useRef)(null),M=(0,r.useCallback)(()=>{C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{A()},300)},[A]),R=(0,r.useRef)(null);(0,r.useEffect)(()=>{R.current=g},[g]);let W=(0,r.useCallback)(e=>{try{let t=JSON.parse(e.data);switch(t.type){case"NEW_VITAL":{let e=t.data,a={time:new Date(e.recorded_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),temperature:e.temperature,has_medication:e.has_medication,medication_type:e.medication_type,recorded_at:e.recorded_at};l(t=>t.some(t=>t.recorded_at===e.recorded_at)?t:[a,...t]);break}case"NEW_IV":f(e=>[t.data,...e]);break;case"IV_PHOTO_UPLOADED":case"ADMISSION_TRANSFERRED":M();break;case"NEW_DOC_REQUEST":m(e=>[t.data,...e]);break;case"NEW_EXAM_SCHEDULE":p(e=>[...e,t.data].sort((e,t)=>new Date(e.scheduled_at).getTime()-new Date(t.scheduled_at).getTime()));break;case"DELETE_EXAM_SCHEDULE":p(e=>e.filter(e=>e.id!==t.data.id));break;case"ADMISSION_DISCHARGED":alert("환자가 퇴원되었습니다."),window.location.reload();break;case"NEW_MEAL_REQUEST":R.current&&t.data.admission_id===R.current&&M()}}catch(e){console.error("WS Parse Error",e)}},[M,l,f,m,p]),{isConnected:L}=(0,n.s)({url:e?"".concat(i.h.getBaseUrl().replace(/^http/,"ws"),"/ws/").concat(e):"",enabled:!!e&&t,onOpen:A,onMessage:W});return(0,r.useEffect)(()=>{e&&t&&A()},[e,t,A]),{vitals:a,checkInAt:s,meals:c,documentRequests:u,ivRecords:h,examSchedules:x,admissionId:g,patientName:_,roomNumber:y,dob:k,gender:S,isConnected:L,isRefreshing:j,refetchDashboard:A,fetchDashboardData:A,addOptimisticVital:(0,r.useCallback)((e,t)=>{let a={temperature:e,recorded_at:t,time:new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),has_medication:!1};l(e=>[a,...e])},[])}}},33795:function(e,t,a){a.d(t,{s:function(){return n}});var r=a(2265);function n(e){let{url:t,enabled:a=!0,onMessage:n,onOpen:i,onClose:l}=e,s=(0,r.useRef)(null),o=(0,r.useRef)(),c=(0,r.useRef)(1e3),[d,u]=(0,r.useState)(!1),m=(0,r.useCallback)(()=>{if(!a||!t)return;s.current&&s.current.close();let e=new WebSocket(t);s.current=e,e.onopen=()=>{console.log("Connected to WS: ".concat(t)),u(!0),c.current=1e3,null==i||i()},e.onclose=()=>{console.log("Disconnected from WS: ".concat(t)),u(!1),null==l||l();let e=c.current;o.current=setTimeout(()=>{m()},e),c.current=Math.min(1.5*e,3e4)},e.onmessage=n},[t,a,n,i,l]);return(0,r.useEffect)(()=>(m(),()=>{s.current&&(s.current.onclose=null,s.current.close()),o.current&&clearTimeout(o.current)}),[m]),{isConnected:d}}},71837:function(e,t,a){a.d(t,{S:function(){return r},h:function(){return o}});let r="http://127.0.0.1:8000",n=window.__TAURI_INTERNALS__,i=async()=>{if(!n)return window.fetch;let{fetch:e}=await a.e(594).then(a.bind(a,41594));return e},l=async(e,t)=>{if(n)try{let{info:r,warn:n,error:i,debug:l}=await a.e(55).then(a.bind(a,88055));({info:r,warn:n,error:i,debug:l})[e]("[Frontend] ".concat(t))}catch(e){console.error("Failed to log to Tauri:",e)}};class s{async request(e,t){let a="".concat(this.baseUrl).concat(e.startsWith("/")?e:"/".concat(e)),r=await i();await l("info","Requesting: ".concat((null==t?void 0:t.method)||"GET"," ").concat(a));try{let e=await r(a,{...t,headers:{"Content-Type":"application/json",...null==t?void 0:t.headers}});if(!e.ok){let r=await e.text().catch(()=>"Unknown error"),n="API Error ".concat(e.status,": ").concat(r);throw console.error(n),await l("error","API Failure: ".concat((null==t?void 0:t.method)||"GET"," ").concat(a," -> ").concat(n)),Error(n)}if(204===e.status)return{};let n=await e.text();return n?JSON.parse(n):{}}catch(e){throw await l("error","Fetch Fatal: ".concat((null==t?void 0:t.method)||"GET"," ").concat(a," -> ").concat(e.message)),e}}get(e,t){return this.request(e,{...t,method:"GET"})}post(e,t,a){return this.request(e,{...a,method:"POST",body:JSON.stringify(t)})}put(e,t,a){return this.request(e,{...a,method:"PUT",body:JSON.stringify(t)})}patch(e,t,a){return this.request(e,{...a,method:"PATCH",body:JSON.stringify(t)})}delete(e,t){return this.request(e,{...t,method:"DELETE"})}getBaseUrl(){return this.baseUrl}constructor(e){this.baseUrl=e}}let o=new s(r)},68057:function(e,t,a){function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;if(!e)return 0;let a=new Date(e),r=new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime(),n=t.getTime()-r;return n<0?1:Math.floor(n/864e5)+1}function n(e,t){if(!e)return"";let a=new Date(e),r=new Date,n=r.getFullYear()-a.getFullYear(),i=r.getMonth()-a.getMonth();(i<0||0===i&&r.getDate()<a.getDate())&&(n--,i+=12);let l=12*n+i,s="";return(s=l<36?"".concat(l,"개월"):"".concat(n,"세"),t)?"".concat(s,"/").concat("M"===t?"남":"F"===t?"여":t):s}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e=>{let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(r)},a=t(e),r=new Date(e);r.setDate(r.getDate()+1);let n=t(r),i=e.getHours();return i<6?[{label:"오늘 아침",date:a,meal_time:"BREAKFAST"},{label:"오늘 점심",date:a,meal_time:"LUNCH"},{label:"오늘 저녁",date:a,meal_time:"DINNER"}]:i>=6&&i<14?[{label:"오늘 점심",date:a,meal_time:"LUNCH"},{label:"오늘 저녁",date:a,meal_time:"DINNER"},{label:"내일 아침",date:n,meal_time:"BREAKFAST"}]:i>=14&&i<19?[{label:"오늘 저녁",date:a,meal_time:"DINNER"},{label:"내일 아침",date:n,meal_time:"BREAKFAST"},{label:"내일 점심",date:n,meal_time:"LUNCH"}]:[{label:"내일 아침",date:n,meal_time:"BREAKFAST"},{label:"내일 점심",date:n,meal_time:"LUNCH"},{label:"내일 저녁",date:n,meal_time:"DINNER"}]}a.d(t,{K5:function(){return i},_7:function(){return n},nK:function(){return r}})}}]);