(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[398],{7420:function(e,t,s){Promise.resolve().then(s.bind(s,21436))},21436:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return K}});var l=s(57437),a=s(2265),r=s(52099),n=s(67404),i=s(26899),o=s(93609),d=s(68057);function c(e){let{name:t,roomNumber:s,temperature:a,infusionRate:c,status:x,dob:m,gender:u,onCardClick:p,onQrClick:b}=e;return(0,l.jsxs)(r.Z,{className:"relative transition-all duration-300 ".concat({fever:"border-status-danger border-2 bg-red-100 shadow-sm shadow-red-200",warning:"border-status-warning border-2 bg-orange-50",normal:"border-status-success border-2 bg-white"}[x]," ").concat(p?"cursor-pointer":""," !p-3 pb-2 pt-4"),onClick:p,children:[(0,l.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-lg font-bold ".concat("fever"===x?"text-red-700":"text-slate-800"),children:s}),(0,l.jsxs)("div",{className:"flex items-center gap-1.5 mt-0.5",children:[(0,l.jsx)("p",{className:"".concat("fever"===x?"text-red-900/70":"text-slate-600"," text-[11px] font-bold"),children:t}),(0,l.jsx)("span",{className:"text-[10px] text-slate-300",children:"|"}),(0,l.jsx)("span",{className:"text-[10px] font-bold ".concat("M"===u?"text-blue-500":"F"===u?"text-rose-500":"text-slate-500"),children:(0,d._7)(m,u)})]})]}),b&&(0,l.jsx)("button",{onClick:b,className:"p-1.5 bg-white/50 hover:bg-white rounded-lg text-slate-400 hover:text-teal-600 transition-colors",title:"보호자용 QR 코드 보기",children:(0,l.jsx)(n.Z,{size:16})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-1.5 mt-2.5",children:[(0,l.jsxs)("div",{className:"bg-slate-100/50 p-1.5 rounded-lg flex flex-col items-center justify-center",children:[(0,l.jsxs)("div",{className:"flex items-center gap-1 text-slate-500 text-[10px] mb-0.5 font-medium",children:[(0,l.jsx)(i.Z,{size:12,className:"text-status-danger"})," 체온"]}),(0,l.jsxs)("div",{className:"text-base font-bold text-slate-800",children:[a,"\xb0"]})]}),(0,l.jsxs)("div",{className:"bg-slate-100/50 p-1.5 rounded-lg flex flex-col items-center justify-center",children:[(0,l.jsxs)("div",{className:"flex items-center gap-1 text-slate-500 text-[10px] mb-0.5 font-medium",children:[(0,l.jsx)(o.Z,{size:12,className:"text-primary"})," 수액"]}),(0,l.jsxs)("div",{className:"flex items-baseline gap-0.5",children:[(0,l.jsx)("span",{className:"text-base font-bold text-slate-800",children:null!=c?c:"-"}),(0,l.jsx)("span",{className:"text-[10px] text-slate-400",children:"cc/hr"})]})]})]})]})}var x=s(94766),m=s(32489),u=s(88893),p=s(66927),b=s(31047),h=s(18930),f=s(48736),g=s(30401),j=s(17689),v=s(53581),N=s(33145),y=s(35398);let w="http://127.0.0.1:8000";function _(e){let{admissionId:t,patientName:s,token:r,onUploadSuccess:n,lastUploadedIv:i}=e,[o,d]=(0,a.useState)(""),[c,x]=(0,a.useState)(""),[u,p]=(0,a.useState)(!1),[b,h]=(0,a.useState)(!1),[f,_]=(0,a.useState)(!1),[k,S]=(0,a.useState)(!1);a.useEffect(()=>{i&&i.admissionId===t&&x(i.url)},[i,t]);let C=async()=>{if(!t||""===t.trim()){alert("이 병상은 현재 입원 정보가 연동되어 있지 않아 기록을 저장할 수 없습니다.");return}p(!0);let e={admission_id:t,infusion_rate:o};c.trim()&&(e.photo_url=c.trim());try{let t=await fetch("".concat(w,"/api/v1/iv-records"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok)h(!0),n(""===o?void 0:Number(o)),x(""),setTimeout(()=>h(!1),3e3);else{let e=await t.json().catch(()=>({}));alert("Upload failed: ".concat(e.detail||"Server error"))}}catch(e){console.error(e),alert("Error uploading record")}finally{p(!1)}},D=r?"".concat(window.location.origin,"/mobile/iv-upload?token=").concat(r):"",E=c?c.startsWith("/")?"".concat(w).concat(c):c:"";return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"relative ".concat(c?"ring-2 ring-orange-400 rounded-xl p-1 -m-1 bg-orange-50/50":""),children:[(0,l.jsxs)("div",{className:"flex items-stretch gap-2 h-10",children:[(0,l.jsxs)("div",{className:"flex-1 min-w-0 relative",children:[(0,l.jsx)("input",{type:"number",value:o,onChange:e=>d(""===e.target.value?"":Number(e.target.value)),placeholder:"0",className:"w-full h-full bg-slate-50 border border-slate-200 rounded-lg px-3 text-sm text-slate-700 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition font-bold"}),(0,l.jsx)("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-slate-400 pointer-events-none",children:"cc/hr"})]}),(0,l.jsxs)("button",{onClick:C,disabled:u||b,className:"flex items-center justify-center gap-1.5 px-3 h-full rounded-lg text-xs font-bold transition-all active:scale-95 shadow-sm border whitespace-nowrap min-w-[70px] ".concat(b?"bg-green-100 text-green-700 border-green-200":c?"bg-orange-500 text-white border-orange-600 hover:bg-orange-600 animate-pulse":"bg-slate-800 text-white border-slate-900 hover:bg-black"),children:[b?(0,l.jsx)(g.Z,{size:14}):(0,l.jsx)(j.Z,{size:14}),(0,l.jsx)("span",{children:u?"저장...":b?"완료":c?"승인":"기록"})]}),(0,l.jsx)("div",{className:"flex-none h-full aspect-square relative",children:c?(0,l.jsxs)("div",{className:"w-full h-full relative bg-slate-100 rounded-lg overflow-hidden border border-slate-200 group cursor-pointer",onClick:()=>S(!0),children:[(0,l.jsx)(N.default,{src:E,alt:"Up",fill:!0,className:"object-cover"}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),x("")},className:"absolute top-0.5 right-0.5 bg-black/50 rounded-full p-0.5",children:(0,l.jsx)(m.Z,{size:10,className:"text-white"})})]}):(0,l.jsx)("button",{onClick:()=>_(!0),className:"w-full h-full border border-slate-300 border-dashed bg-slate-50 rounded-lg flex items-center justify-center text-slate-400 hover:bg-slate-100 transition-all",title:"QR 업로드",children:(0,l.jsx)(v.Z,{size:16})})})]}),f&&r&&(0,l.jsxs)("div",{className:"absolute top-full right-0 mt-2 bg-white z-20 flex flex-col items-center justify-center rounded-xl p-3 animate-in fade-in zoom-in-95 border border-slate-200 shadow-xl w-48",children:[(0,l.jsx)("button",{onClick:()=>_(!1),className:"absolute top-2 right-2 text-slate-300 hover:text-slate-500",children:(0,l.jsx)(m.Z,{size:16})}),(0,l.jsx)("p",{className:"text-xs text-slate-600 mb-3 font-bold text-center",children:"모바일 스캔하여 업로드"}),(0,l.jsx)("div",{className:"bg-white p-1 rounded-lg border border-slate-100",children:(0,l.jsx)(y.Q,{value:D,size:120})})]})]}),k&&E&&(0,l.jsx)("div",{className:"fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in",onClick:()=>S(!1),children:(0,l.jsxs)("div",{className:"relative w-full h-full max-w-5xl max-h-[90vh] flex flex-col items-center justify-center",children:[(0,l.jsx)("div",{className:"relative w-full h-full",children:(0,l.jsx)(N.default,{src:E,alt:"Zoomed IV",fill:!0,className:"object-contain"})}),(0,l.jsx)("p",{className:"text-white/70 mt-4 text-sm font-medium",children:"화면을 클릭하면 닫힙니다"})]})})]})}var k=s(10425);let S={GENERAL:"일반식",SOFT:"죽",NPO:"금식"},C={RECEIPT:"영수증",DETAIL:"세부내역서",CERT:"진단서",DIAGNOSIS:"소견서",INITIAL:"기록지"},D=["흉부 X-Ray","복부 X-Ray","초음파","소변검사","혈액검사","심전도 검사","PCR 검사","신속항원검사","대변검사"],E=["301","302","303","304","305","306","307","308","309","310-1","310-2","311-1","311-2","311-3","311-4","312","313","314","315-1","315-2","315-3","315-4","401-1","401-2","401-3","401-4","402-1","402-2","402-3","402-4"];var I=s(71837),z=s(76858);function T(e){let{isOpen:t,onClose:s,currentRoom:r,onTransfer:n}=e,[i,o]=(0,a.useState)(""),[d,c]=(0,a.useState)(!1);if(!t)return null;let x=async e=>{if(e.preventDefault(),!i){alert("이동할 병실을 선택해주세요.");return}if(i===r){alert("현재 병실과 동일합니다.");return}if(confirm("".concat(r,"호 -> ").concat(i,"호로 이동하시겠습니까?"))){c(!0);try{await n(i),s()}catch(e){console.error(e),alert("전실 처리 실패 (이미 사용 중인 병실일 수 있습니다)")}finally{c(!1)}}};return(0,l.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in",children:(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-slate-100",children:[(0,l.jsxs)("h3",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[(0,l.jsx)(z.Z,{size:20,className:"text-blue-600"}),"병실 이동 (전실)"]}),(0,l.jsx)("button",{onClick:s,className:"text-slate-400 hover:text-slate-600",children:(0,l.jsx)(m.Z,{size:20})})]}),(0,l.jsxs)("form",{onSubmit:x,className:"p-6 flex flex-col gap-4",children:[(0,l.jsxs)("div",{className:"text-center mb-2",children:[(0,l.jsxs)("span",{className:"text-xl font-bold text-slate-700",children:[r,"호"]}),(0,l.jsx)("span",{className:"mx-2 text-slate-400",children:"→"}),(0,l.jsxs)("span",{className:"text-xl font-bold text-blue-600",children:[i||"?","호"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"이동할 병실 선택"}),(0,l.jsxs)("select",{value:i,onChange:e=>o(e.target.value),className:"w-full p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all bg-white",children:[(0,l.jsx)("option",{value:"",children:"병실 선택"}),E.filter(e=>e!==r).map(e=>(0,l.jsxs)("option",{value:e,children:[e,"호"]},e))]})]}),(0,l.jsx)("div",{className:"pt-2",children:(0,l.jsx)("button",{type:"submit",disabled:d||!i,className:"w-full py-3 bg-blue-600 text-white rounded-xl font-bold text-lg hover:bg-blue-700 active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:d?"이동 중...":"이동 완료"})})]})]})})}function O(e){let{isOpen:t,onClose:s,admissionId:r,onSuccess:n}=e,[i,o]=(0,a.useState)(""),[d,c]=(0,a.useState)(!1);if(!t)return null;let x=async e=>{if(e.preventDefault(),!i)return;c(!0);let t=new Date().toISOString();try{await I.h.post("/api/v1/vitals",{admission_id:r,temperature:parseFloat(i),has_medication:!1,recorded_at:t}),n(parseFloat(i),t),s(),o("")}catch(e){alert("체온 저장 실패"),console.error(e)}finally{c(!1)}};return(0,l.jsxs)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:s}),(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-xs z-10 p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"체온 입력"}),(0,l.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"체온 (\xb0C)"}),(0,l.jsx)("input",{type:"number",step:"0.1",value:i,onChange:e=>o(e.target.value),className:"w-full text-lg p-2 border rounded-lg text-center font-bold",placeholder:"36.5",autoFocus:!0})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:s,className:"flex-1 py-2 text-sm font-bold text-slate-600 bg-slate-100 rounded-lg hover:bg-slate-200",children:"취소"}),(0,l.jsx)("button",{type:"submit",disabled:d||!i,className:"flex-1 py-2 text-sm font-bold text-white bg-green-500 rounded-lg hover:bg-green-600 disabled:opacity-50",children:"저장"})]})]})]})]})}let A=["일반식","죽1","죽2","죽3"],M=["일반식","선택 안함"];function Z(e){let{isOpen:t,onClose:s,label:r,date:n,mealTime:i,currentPediatric:o,currentGuardian:d,onSave:c}=e,[x,u]=(0,a.useState)(o),[p,b]=(0,a.useState)(d),[h,f]=(0,a.useState)(!1);if(!t)return null;let j=async e=>{e.preventDefault(),f(!0);try{await c(x,p),s()}catch(e){console.error(e),alert("저장 실패")}finally{f(!1)}};return(0,l.jsxs)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm",onClick:s}),(0,l.jsxs)("div",{className:"bg-white rounded-[1.5rem] w-full max-w-sm shadow-2xl relative overflow-hidden flex flex-col",children:[(0,l.jsxs)("div",{className:"p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{className:"text-lg font-bold text-slate-800",children:[r," 식사 수정"]}),(0,l.jsxs)("p",{className:"text-[10px] text-slate-400 font-medium uppercase tracking-wider",children:[n," / ",i]})]}),(0,l.jsx)("button",{onClick:s,className:"p-1.5 hover:bg-slate-200 rounded-full text-slate-400 transition-colors",children:(0,l.jsx)(m.Z,{size:18})})]}),(0,l.jsxs)("form",{onSubmit:j,className:"p-6 space-y-5",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-xs font-bold text-slate-500 flex items-center gap-1.5 ml-1",children:"환아 식사"}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2",children:A.map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>u(e),className:"px-3 py-2.5 rounded-xl text-xs font-bold border-2 transition-all ".concat(x===e?"bg-primary/5 border-primary text-primary":"bg-white border-slate-100 text-slate-400 hover:border-slate-200"),children:e},e))})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-xs font-bold text-slate-500 flex items-center gap-1.5 ml-1",children:"보호자 식사"}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2",children:M.map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>b(e),className:"px-3 py-2.5 rounded-xl text-xs font-bold border-2 transition-all ".concat(p===e?"bg-primary/5 border-primary text-primary":"bg-white border-slate-100 text-slate-400 hover:border-slate-200"),children:e},e))})]}),(0,l.jsxs)("div",{className:"pt-4 flex gap-3",children:[(0,l.jsx)("button",{type:"button",onClick:s,className:"flex-1 py-3 bg-slate-50 text-slate-500 rounded-xl text-sm font-bold hover:bg-slate-100 transition-colors",children:"취소"}),(0,l.jsx)("button",{type:"submit",disabled:h,className:"flex-1 py-3 bg-primary text-white rounded-xl text-sm font-bold shadow-lg shadow-primary/20 hover:bg-primary/90 transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:h?"저장 중...":(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(g.Z,{size:18}),"저장하기"]})})]})]})]})]})}function R(e){let{isOpen:t,onClose:s,onSave:r}=e,[n,i]=(0,a.useState)(""),[o,d]=(0,a.useState)(new Date().toISOString().split("T")[0]),[c,x]=(0,a.useState)("am"),[u,p]=(0,a.useState)(!1),[h,f]=(0,a.useState)(null);if(!t)return null;let j=async e=>{if(e.preventDefault(),!n){f("검사 항목을 선택해주세요.");return}f(null),p(!0);try{await r({name:n,date:o,timeOfDay:c}),i(""),s()}catch(e){console.error(e),f("일정 저장에 실패했습니다.")}finally{p(!1)}};return(0,l.jsxs)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm",onClick:s}),(0,l.jsxs)("div",{className:"bg-white rounded-[1.5rem] w-full max-w-sm shadow-2xl relative overflow-hidden flex flex-col animate-in fade-in zoom-in-95 duration-200",children:[(0,l.jsxs)("div",{className:"p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"p-2 bg-violet-100 text-violet-600 rounded-xl",children:(0,l.jsx)(b.Z,{size:18})}),(0,l.jsx)("h3",{className:"text-lg font-bold text-slate-800",children:"검사 일정 등록"})]}),(0,l.jsx)("button",{onClick:s,className:"p-1.5 hover:bg-slate-200 rounded-full text-slate-400 transition-colors",children:(0,l.jsx)(m.Z,{size:18})})]}),(0,l.jsxs)("form",{onSubmit:j,className:"p-6 space-y-5",children:[h&&(0,l.jsx)("div",{className:"p-3 bg-red-50 text-red-500 text-xs rounded-xl font-medium border border-red-100",children:h}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-xs font-bold text-slate-500 ml-1",children:"날짜 선택"}),(0,l.jsx)("input",{type:"date",value:o,onChange:e=>d(e.target.value),className:"w-full bg-slate-50 border-2 border-slate-100 rounded-xl px-4 py-3 text-sm font-bold text-slate-700 focus:outline-none focus:border-violet-500 transition-all cursor-pointer"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-xs font-bold text-slate-500 ml-1",children:"시간대"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>x("am"),className:"flex-1 py-3 rounded-xl text-sm font-bold border-2 transition-all ".concat("am"===c?"border-violet-500 bg-violet-50 text-violet-700 font-extrabold":"border-slate-100 bg-white text-slate-400"),children:"오전"}),(0,l.jsx)("button",{type:"button",onClick:()=>x("pm"),className:"flex-1 py-3 rounded-xl text-sm font-bold border-2 transition-all ".concat("pm"===c?"border-violet-500 bg-violet-50 text-violet-700 font-extrabold":"border-slate-100 bg-white text-slate-400"),children:"오후"})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-xs font-bold text-slate-500 ml-1",children:"검사 항목"}),(0,l.jsxs)("select",{value:n,onChange:e=>i(e.target.value),className:"w-full bg-slate-50 border-2 border-slate-100 rounded-xl px-4 py-3 text-sm font-bold text-slate-700 focus:outline-none focus:border-violet-500 transition-all cursor-pointer appearance-none",children:[(0,l.jsx)("option",{value:"",children:"검사 선택"}),D.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]})]}),(0,l.jsxs)("div",{className:"pt-4 flex gap-3",children:[(0,l.jsx)("button",{type:"button",onClick:s,className:"flex-1 py-3.5 bg-slate-100 text-slate-500 rounded-xl text-sm font-bold hover:bg-slate-200 transition-colors",children:"취소"}),(0,l.jsx)("button",{type:"submit",disabled:u,className:"flex-1 py-3.5 bg-violet-500 text-white rounded-xl text-sm font-bold shadow-lg shadow-violet-200 hover:bg-violet-600 transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:u?"저장 중...":(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(g.Z,{size:18}),"저장하기"]})})]})]})]})]})}var U=s(68934);function F(e){var t,s;let{isOpen:r,onClose:n,bed:o,notifications:c,onCompleteRequest:j,onIVUploadSuccess:v,onVitalUpdate:N,vitals:y,checkInAt:w,lastUploadedIv:D,lastUpdated:E}=e,[z,A]=(0,a.useState)(!1),[M,F]=(0,a.useState)(null),[P,q]=(0,a.useState)(!1),[L,V]=(0,a.useState)(!1),[H,Q]=(0,a.useState)(null),W=async()=>{if((null==o?void 0:o.id)&&window.confirm("".concat(o.name," 환자를 퇴원 처리할까요?")))try{await I.h.post("/api/v1/admissions/".concat(o.id,"/discharge"),{}),alert("퇴원 완료"),n(),window.location.reload()}catch(e){alert("퇴원 실패")}},Y=async()=>{if((null==o?void 0:o.id)&&window.confirm("[Dev] ".concat(o.name," 환자에게 가상 데이터를 생성할까요?")))try{await I.h.post("/api/v1/dev/seed-patient/".concat(o.id),{}),await ea(),alert("데이터 생성 및 동기화 완료")}catch(e){alert("데이터 생성 실패")}},G=async e=>{if(null==o?void 0:o.id)try{await I.h.post("/api/v1/admissions/".concat(o.id,"/transfer"),{target_room:e}),alert("전실 완료"),q(!1),n(),window.location.reload()}catch(e){alert("전실 실패: 이미 사용 중인 병실이거나 오류가 발생했습니다.")}},X=(0,a.useMemo)(()=>o?c.filter(e=>String(e.room)===String(o.room)):[],[c,o]),B=async e=>{if(null==o?void 0:o.id)try{let[t,s,l]=e.date.split("-").map(Number),a="am"===e.timeOfDay?9:14,r=new Date(t,s-1,l,a,0).toISOString();await I.h.post("/api/v1/exam-schedules",{admission_id:o.id,scheduled_at:r,name:e.name.trim(),note:""}),ea()}catch(e){throw console.error(e),e}},K=async e=>{if(window.confirm("이 검사 일정을 삭제할까요?")){F(e);try{await I.h.delete("/api/v1/exam-schedules/".concat(e)),ea()}finally{F(null)}}},{vitals:J,checkInAt:$,meals:ee,documentRequests:et,examSchedules:es,isRefreshing:el,fetchDashboardData:ea,addOptimisticVital:er}=(0,U.y)(null==o?void 0:o.token,r),en=async(e,t)=>{if((null==o?void 0:o.id)&&H)try{var s;await I.h.post("/api/v1/meals/requests",{admission_id:o.id,request_type:"STATION_UPDATE",meal_date:H.date,meal_time:H.meal_time,pediatric_meal_type:e,guardian_meal_type:t,room_note:(null===(s=ee.find(e=>e.meal_date===H.date&&e.meal_time===H.meal_time))||void 0===s?void 0:s.room_note)||""}),ea()}catch(e){throw console.error(e),e}};(0,a.useEffect)(()=>{r&&(null==o?void 0:o.token)&&ea()},[r,null==o?void 0:o.token,ea,E]);let ei=ee.length>0?ee[0]:null;ei&&("STATION_UPDATE"===ei.request_type?ei.pediatric_meal_type:null!==(t=S[ei.request_type])&&void 0!==t||ei.request_type),et.length>0&&et[0];let{chartVitals:eo,chartCheckIn:ed}=(0,a.useMemo)(()=>o?y&&y.length>0?{chartVitals:y,chartCheckIn:null!=w?w:null}:J.length>0?{chartVitals:J,chartCheckIn:$}:{chartVitals:[],chartCheckIn:$||w||null}:{chartVitals:[],chartCheckIn:null},[o,y,w,J,$]),ec=J.length>0?J[0]:null,ex=ec?ec.temperature:o.temp,em=ec?ec.recorded_at:o.last_vital_at;return r&&o?(0,l.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity",onClick:n}),(0,l.jsxs)("div",{className:"bg-white rounded-[2rem] w-[75%] max-w-none max-h-[85vh] shadow-2xl overflow-hidden flex flex-col transition-all duration-300 transform ".concat(r?"scale-100 opacity-100":"scale-95 opacity-0"),children:[(0,l.jsxs)("div",{className:"px-8 py-6 shrink-0 ".concat("fever"===o.status?"bg-red-50":"bg-slate-50"," border-b border-slate-100"),children:[(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("h2",{className:"text-3xl font-bold text-slate-800 tracking-tight",children:o.name}),(0,l.jsx)("span",{className:"text-xl text-slate-300 font-light",children:"/"}),(0,l.jsxs)("p",{className:"text-slate-500 font-bold text-base mt-1",children:[o.room,"호"]}),o.dob&&(0,l.jsxs)("span",{className:"text-base mt-1 ml-1 font-bold ".concat("M"===o.gender?"text-blue-500":"F"===o.gender?"text-rose-500":"text-slate-500"),children:["/ (",(0,d._7)(o.dob,o.gender),")"]}),"fever"===o.status&&(0,l.jsx)("span",{className:"ml-2 px-2 py-0.5 bg-red-100 text-red-600 text-[10px] font-bold rounded-full",children:"고열 주의"})]}),(0,l.jsxs)("div",{className:"flex gap-2 -mt-1",children:[(0,l.jsx)("button",{onClick:W,className:"px-4 py-2 bg-red-50 text-red-600 text-xs font-bold rounded-xl hover:bg-red-100 transition-colors",children:"퇴원"}),(0,l.jsx)("button",{onClick:()=>q(!0),className:"px-4 py-2 bg-blue-50 text-blue-600 text-xs font-bold rounded-xl hover:bg-blue-100 transition-colors",children:"전실"}),(0,l.jsx)("button",{onClick:Y,className:"px-4 py-2 bg-indigo-50 text-indigo-600 text-xs font-bold rounded-xl hover:bg-indigo-100 transition-colors",title:"가상 데이터 생성 (Dev)",children:"Dev"}),(0,l.jsx)("button",{onClick:n,className:"p-2 -mr-2 -mt-2 hover:bg-black/5 rounded-full text-slate-400 transition-colors",children:(0,l.jsx)(m.Z,{size:24})})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-2 mt-4",children:[(0,l.jsx)("div",{className:"lg:col-span-7",children:(0,l.jsxs)("div",{className:"grid grid-cols-5 gap-2 h-full",children:[(0,l.jsxs)("button",{onClick:()=>V(!0),className:"col-span-1 bg-white rounded-[1.2rem] border-[1.5px] ".concat(em&&(Date.now()-new Date(em).getTime())/36e5>=2?(()=>{if(!em)return"border-slate-200";let e=(Date.now()-new Date(em).getTime())/36e5;return e>=4?"border-red-500 ring-4 ring-red-100":e>=2?"border-orange-400 ring-4 ring-orange-100":"border-slate-200"})():"border-slate-200"," shadow-sm flex flex-col justify-center items-center hover:bg-slate-50 transition-all py-1.5 px-1"),children:[(0,l.jsx)("span",{className:"text-[10px] text-slate-400 block mb-0.5 font-bold uppercase tracking-tight",children:"체온"}),(0,l.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,l.jsx)("span",{className:"text-lg font-bold ".concat(null!==ex&&ex>=38?"text-red-500":"text-slate-700"),children:null!==ex?ex.toFixed(1):"-"}),(0,l.jsx)("span",{className:"text-[10px] text-slate-400 font-bold mt-1",children:"\xb0C"})]})]}),(0,l.jsxs)("div",{className:"col-span-1 bg-white rounded-[1.2rem] border-[1.5px] border-slate-200 shadow-sm flex flex-col justify-center items-center py-1.5 px-1",children:[(0,l.jsx)("span",{className:"text-[10px] text-slate-400 block mb-0.5 font-bold uppercase tracking-tight",children:"속도"}),(0,l.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,l.jsx)("span",{className:"text-lg font-bold text-slate-700",children:null!==(s=o.drops)&&void 0!==s?s:"-"}),(0,l.jsx)("span",{className:"text-[10px] text-slate-400 font-bold mt-1",children:"cc/hr"})]})]}),(0,d.K5)().map(e=>{let t=ee.find(t=>t.meal_date===e.date&&t.meal_time===e.meal_time);return t&&t.pediatric_meal_type,(0,l.jsxs)("div",{className:"col-span-1 bg-white rounded-[1.2rem] border-[1.5px] border-slate-200 shadow-sm flex flex-col justify-center items-center relative group/meal py-1.5 px-1",children:[(0,l.jsx)("button",{onClick:()=>Q({...e,pediatric:(null==t?void 0:t.pediatric_meal_type)||"선택 안함",guardian:(null==t?void 0:t.guardian_meal_type)||"선택 안함"}),className:"absolute top-1 right-1 p-1 text-slate-300 hover:text-slate-500 rounded-full hover:bg-slate-50 transition-colors opacity-0 group-hover/meal:opacity-100",title:"".concat(e.label," 식사 수정"),children:(0,l.jsx)(u.Z,{size:10})}),(0,l.jsx)("span",{className:"text-[10px] text-slate-400 block mb-0.5 font-bold uppercase tracking-tight",children:e.label}),(0,l.jsxs)("div",{className:"text-[11px] font-bold text-slate-700 flex flex-col items-center leading-tight",children:[(0,l.jsx)("span",{children:(null==t?void 0:t.pediatric_meal_type)||"환아식 미신청"}),(0,l.jsx)("span",{className:"text-slate-300 font-light my-[-2px]",children:"/"}),(0,l.jsx)("span",{children:(null==t?void 0:t.guardian_meal_type)||"보호자식 미신청"})]})]},e.label)})]})}),(0,l.jsx)("div",{className:"lg:col-span-5 h-full",children:(0,l.jsxs)("div",{className:"bg-white px-4 py-2 rounded-[1.5rem] border-[1.5px] border-slate-200 shadow-sm relative group/iv h-full flex flex-col justify-center",children:[(0,l.jsx)("div",{className:"flex items-center justify-between mb-1 px-1",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"p-1.5 bg-sky-50 text-sky-500 rounded-full",children:(0,l.jsx)(p.Z,{size:14})}),(0,l.jsx)("h3",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-tight",children:"IV 수액 속도 기록"})]})}),(0,l.jsx)(_,{admissionId:o.id,patientName:o.name,token:o.token,onUploadSuccess:e=>null==v?void 0:v(e),lastUploadedIv:D})]})})]})]}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto p-6 scrollbar-hide",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[(0,l.jsx)("div",{className:"lg:col-span-7 space-y-6",children:(0,l.jsxs)("section",{className:"bg-slate-50/50 rounded-2xl p-4 border border-slate-100",children:[(0,l.jsxs)("h3",{className:"text-sm font-bold text-slate-700 mb-4 flex items-center gap-2",children:[(0,l.jsx)(i.Z,{size:16,className:"text-rose-500"}),"체온 기록 (24h)"]}),(0,l.jsx)(k.X,{data:eo,checkInAt:ed,className:"h-auto min-h-[340px] border-[1.5px] border-slate-600 shadow-sm"})]})}),(0,l.jsxs)("div",{className:"lg:col-span-5 space-y-6 flex flex-col",children:[(0,l.jsxs)("section",{className:"bg-slate-50/50 rounded-2xl p-4 border border-slate-100 flex-1",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsxs)("h3",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[(0,l.jsx)(b.Z,{size:16,className:"text-primary"}),"예정된 검사 일정"]}),(0,l.jsx)("button",{onClick:()=>A(!0),className:"text-[10px] bg-violet-100 text-violet-600 px-2 py-1 rounded-lg font-bold hover:bg-violet-200 transition",children:"일정 등록"})]}),(0,l.jsxs)("div",{className:"space-y-3 max-h-[160px] overflow-y-auto pr-1",children:[es.map(e=>(0,l.jsxs)("div",{className:"p-3 bg-white rounded-xl border-[1.5px] border-slate-600 shadow-sm text-xs flex justify-between items-center gap-2",children:[(0,l.jsx)("div",{className:"min-w-0 flex-1",children:(0,l.jsxs)("div",{className:"flex justify-between mb-0.5",children:[(0,l.jsx)("span",{className:"font-bold text-slate-700",children:e.name}),(0,l.jsx)("span",{className:"text-slate-400 shrink-0",children:function(e){let t=new Date(e),s=t.getHours(),l=t.getMinutes();return s<12?"오전 ".concat(0===s?12:s).concat(l?":".concat(l.toString().padStart(2,"0")):":00"):"오후 ".concat(12===s?12:s-12).concat(l?":".concat(l.toString().padStart(2,"0")):":00")}(e.scheduled_at)})]})}),(0,l.jsx)("button",{type:"button",onClick:()=>K(e.id),disabled:M===e.id,className:"shrink-0 p-1.5 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors shadow-sm disabled:opacity-50",title:"삭제",children:(0,l.jsx)(h.Z,{size:14})})]},e.id)),0===es.length&&(0,l.jsx)("p",{className:"text-xs text-slate-400 text-center py-4",children:"등록된 일정이 없습니다."})]})]}),(0,l.jsxs)("section",{className:"bg-slate-50/50 rounded-2xl p-4 border border-slate-100 flex-1",children:[(0,l.jsxs)("h3",{className:"text-sm font-bold text-slate-700 mb-2 flex items-center gap-2",children:[(0,l.jsx)(f.Z,{size:16,className:"text-sky-500"}),"신청된 서류"]}),(0,l.jsx)("div",{className:"bg-white rounded-xl border-[1.5px] border-slate-600 p-4 shadow-sm",children:et.filter(e=>"COMPLETED"===e.status).length>0?(0,l.jsx)("div",{className:"space-y-3",children:et.filter(e=>"COMPLETED"===e.status).map(e=>(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsxs)("div",{className:"text-[10px] text-slate-400 font-bold",children:[new Date(e.created_at).toLocaleDateString()," 신청분"]}),(0,l.jsx)("ul",{className:"space-y-1 text-xs text-slate-600",children:e.request_items.map(e=>(0,l.jsxs)("li",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"w-1 h-1 rounded-full bg-sky-400 shrink-0"}),C[e]||e]},e))})]},e.id))}):(0,l.jsx)("p",{className:"text-xs text-slate-400",children:"신청된 서류 없음"})})]}),(0,l.jsxs)("section",{className:"bg-slate-50/50 rounded-2xl p-4 border border-slate-100 flex-1",children:[(0,l.jsxs)("h3",{className:"text-sm font-bold text-slate-700 mb-4 flex items-center gap-2",children:[(0,l.jsx)(x.Z,{size:16,className:"text-amber-500"}),"요청 사항 (",X.length,")"]}),(0,l.jsxs)("div",{className:"space-y-3 max-h-[160px] overflow-y-auto pr-1",children:[X.map(e=>(0,l.jsxs)("div",{className:"p-3 bg-white rounded-xl border-[1.5px] border-slate-600 shadow-sm flex items-center justify-between gap-3",children:[(0,l.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,l.jsx)("span",{className:"text-[10px] font-bold text-slate-400 block mb-0.5",children:e.time}),(0,l.jsx)("p",{className:"text-xs text-slate-700 line-clamp-2 leading-snug",children:e.content})]}),(0,l.jsxs)("button",{onClick:()=>null==j?void 0:j(e.id,e.type,o.id),className:"px-4 py-2 bg-teal-600 text-white font-bold rounded-xl hover:bg-teal-700 transition-all flex items-center gap-1.5",children:[(0,l.jsx)(g.Z,{size:16}),"완료"]})]},e.id)),0===X.length&&(0,l.jsx)("p",{className:"text-xs text-slate-400 text-center py-4",children:"대기 중인 요청이 없습니다."})]})]})]})]})})]}),P&&(0,l.jsx)(T,{isOpen:P,onClose:()=>q(!1),onTransfer:G,currentRoom:o.room}),L&&(0,l.jsx)(O,{isOpen:L,onClose:()=>V(!1),admissionId:o.id,onSuccess:(e,t)=>{er(e,t),ea(),null==N||N(e)}}),H&&(0,l.jsx)(Z,{isOpen:!!H,onClose:()=>Q(null),label:H.label,date:H.date,mealTime:H.meal_time,currentPediatric:H.pediatric,currentGuardian:H.guardian,onSave:en}),(0,l.jsx)(R,{isOpen:z,onClose:()=>A(!1),onSave:B})]}):null}var P=s(98702);function q(e){let{isOpen:t,onClose:s,patientName:r,roomNumber:n,token:i}=e,[o,d]=a.useState("");a.useEffect(()=>{d(window.location.origin)},[]);let c="".concat(o,"/dashboard?token=").concat(i);return(0,l.jsx)(P.u,{isOpen:t,onClose:s,title:"보호자 대시보드 QR (".concat(n,"호 ").concat(r,")"),children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-6 space-y-6",children:[(0,l.jsx)("div",{className:"bg-white p-4 rounded-xl shadow-lg border border-slate-100",children:o&&i?(0,l.jsx)(y.t,{value:c,size:200,level:"H",includeMargin:!0}):(0,l.jsx)("div",{className:"w-[200px] h-[200px] bg-slate-100 animate-pulse rounded-lg flex items-center justify-center text-slate-400",children:"Loading..."})}),(0,l.jsxs)("div",{className:"text-center space-y-2",children:[(0,l.jsxs)("p",{className:"text-sm text-slate-500",children:["보호자의 스마트폰 카메라로",(0,l.jsx)("br",{}),"위 QR 코드를 스캔해 주세요."]}),(0,l.jsx)("p",{className:"text-xs text-slate-400 bg-slate-50 py-2 px-4 rounded-full font-mono mt-2 break-all",children:c})]}),(0,l.jsx)("div",{className:"w-full pt-4 border-t border-slate-100",children:(0,l.jsx)("button",{onClick:s,className:"w-full py-3 rounded-xl bg-slate-100 text-slate-600 font-bold hover:bg-slate-200 transition-colors",children:"닫기"})})]})})}var L=s(37806);function V(e){let{isOpen:t,onClose:s,roomNumber:r,onAdmit:n}=e,[i,o]=(0,a.useState)(""),[d,c]=(0,a.useState)(""),[x,u]=(0,a.useState)("M"),[p,b]=(0,a.useState)(!1);if(!t)return null;let h=async e=>{if(e.preventDefault(),!i.trim()||!d.trim()){alert("이름과 생년월일을 입력해주세요.");return}b(!0);try{await n(i,d,x),s(),o(""),c("")}catch(e){console.error(e),alert("입원 처리 중 오류가 발생했습니다.")}finally{b(!1)}};return(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in",children:(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-slate-100",children:[(0,l.jsxs)("h3",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[(0,l.jsx)(L.Z,{size:20,className:"text-teal-600"}),"입원 수속 (",r,"호)"]}),(0,l.jsx)("button",{onClick:s,className:"text-slate-400 hover:text-slate-600",children:(0,l.jsx)(m.Z,{size:20})})]}),(0,l.jsxs)("form",{onSubmit:h,className:"p-6 flex flex-col gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"환자 이름"}),(0,l.jsx)("input",{type:"text",value:i,onChange:e=>o(e.target.value),placeholder:"이름 입력 (예: 김우주)",className:"w-full p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none transition-all",autoFocus:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"생년월일"}),(0,l.jsx)("input",{type:"text",value:d,onChange:e=>c(e.target.value),placeholder:"YYYY-MM-DD",className:"w-full p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none transition-all"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"성별"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>u("M"),className:"flex-1 py-3 rounded-xl font-bold transition-all ".concat("M"===x?"bg-blue-500 text-white shadow-sm":"bg-slate-50 text-slate-400 border border-slate-200"),children:"남아 (M)"}),(0,l.jsx)("button",{type:"button",onClick:()=>u("F"),className:"flex-1 py-3 rounded-xl font-bold transition-all ".concat("F"===x?"bg-rose-500 text-white shadow-sm":"bg-slate-50 text-slate-400 border border-slate-200"),children:"여아 (F)"})]})]}),(0,l.jsx)("div",{className:"pt-2",children:(0,l.jsx)("button",{type:"submit",disabled:p,className:"w-full py-3 bg-teal-600 text-white rounded-xl font-bold text-lg hover:bg-teal-700 active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:p?"처리 중...":"입원 완료"})})]})]})})}var H=s(33795),Q=s(40257);let W=["일반식","죽1","죽2","죽3","선택 안함"],Y=["일반식","선택 안함"],G=e=>{let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(l)},X=e=>"".concat(e.getMonth()+1,"/").concat(e.getDate()," (").concat(["일","월","화","수","목","금","토"][e.getDay()],")");function B(e){let{beds:t}=e,[s,r]=(0,a.useState)(new Date),[n,i]=(0,a.useState)({}),[o,d]=(0,a.useState)(!1),c=(0,a.useMemo)(()=>t.filter(e=>e.id&&e.name),[t]),x=[0,1,2].map(e=>{let t=new Date;return t.setDate(t.getDate()+e),t}),m=(0,a.useCallback)(async()=>{d(!0);try{let e=G(s),t=await I.h.get("/api/v1/meals/matrix?target_date=".concat(e)),l={};c.forEach(e=>{e.id&&(l[e.id]={})}),Array.isArray(t)&&t.forEach(e=>{e.admission_id&&e.meal_time&&(l[e.admission_id]||(l[e.admission_id]={}),l[e.admission_id][e.meal_time]=e)}),i(l)}catch(e){console.error("Fetch Matrix Error",e)}finally{d(!1)}},[s,c]);(0,a.useEffect)(()=>{m()},[s,m]);let u=async(e,t,l,a)=>{var r;if(!e.id)return;let o=(null===(r=n[e.id])||void 0===r?void 0:r[t])||{};i(s=>({...s,[e.id]:{...s[e.id],[t]:{...o,[l]:a}}}));try{let r={admission_id:e.id,request_type:"STATION_UPDATE",meal_date:G(s),meal_time:t,pediatric_meal_type:"pediatric_meal_type"===l?a:o.pediatric_meal_type||"선택 안함",guardian_meal_type:"guardian_meal_type"===l?a:o.guardian_meal_type||"선택 안함",room_note:"room_note"===l?a:o.room_note||""};await I.h.post("/api/v1/meals/requests",r)}catch(e){console.error("Update Failed",e),alert("저장 실패"),m()}},p=(e,t,s)=>{var a;if(!e.id)return null;let r=null===(a=n[e.id])||void 0===a?void 0:a[t],i="child"===s?(null==r?void 0:r.pediatric_meal_type)||"선택 안함":(null==r?void 0:r.guardian_meal_type)||"선택 안함",o="child"===s?null==r?void 0:r.requested_pediatric_meal_type:null==r?void 0:r.requested_guardian_meal_type,d=(null==r?void 0:r.status)==="PENDING"&&o&&o!==i;return(0,l.jsx)("td",{className:"p-0 border border-slate-300 h-[32px] relative ".concat(d?"bg-orange-50":""),children:(0,l.jsxs)("div",{className:"flex items-center h-full",children:[(0,l.jsx)("select",{className:"flex-1 h-full text-center bg-transparent border-none text-xs focus:ring-inset focus:ring-1 focus:ring-blue-500 cursor-pointer ".concat("선택 안함"!==i?"font-bold text-slate-800":"text-slate-400"),value:i,onChange:l=>u(e,t,"child"===s?"pediatric_meal_type":"guardian_meal_type",l.target.value),children:("child"===s?W:Y).map(e=>(0,l.jsx)("option",{value:e,children:e},e))}),d&&(0,l.jsx)("button",{title:"환자 신청: ".concat(o),onClick:()=>u(e,t,"child"===s?"pediatric_meal_type":"guardian_meal_type",o),className:"absolute -top-1 -right-1 w-4 h-4 bg-orange-500 text-white rounded-full flex items-center justify-center text-[10px] font-bold hover:bg-orange-600 shadow-sm z-10 animate-pulse",children:"!"})]})})};return(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow p-4 h-full overflow-hidden flex flex-col",children:[(0,l.jsxs)("div",{className:"flex justify-between items-end mb-2",children:[(0,l.jsx)("div",{className:"flex gap-1",children:x.map((e,t)=>{let a=G(e)===G(s);return(0,l.jsx)("button",{onClick:()=>r(e),className:"px-4 py-2 rounded-t-lg text-sm font-bold border-t border-x transition-colors ".concat(a?"bg-white border-slate-300 text-teal-700 z-10 -mb-[1px]":"bg-slate-100 border-transparent text-slate-500 hover:bg-slate-200"),children:X(e)},t)})}),(0,l.jsxs)("div",{className:"flex gap-2 items-center mb-1",children:[(0,l.jsx)("button",{onClick:async()=>{if(window.confirm("[Dev] ".concat(X(s),"의 모든 환자 식단을 생성할까요?")))try{await I.h.post("/api/v1/dev/seed-meals?target_date=".concat(G(s)),{}),m(),alert("식단 생성 완료")}catch(e){alert("생성 실패")}},className:"px-3 py-1.5 text-[10px] bg-indigo-50 text-indigo-600 border border-indigo-200 rounded-lg hover:bg-indigo-100 font-bold",children:"식단 일괄 생성 (Dev)"}),(0,l.jsx)("div",{className:"text-xs text-slate-400",children:o?"로딩중...":"자동 저장됨"})]})]}),(0,l.jsx)("div",{className:"flex-1 overflow-auto border border-slate-300 relative bg-white",children:(0,l.jsxs)("table",{className:"w-full text-xs text-left border-collapse",children:[(0,l.jsxs)("thead",{className:"bg-slate-100 text-slate-700 font-bold sticky top-0 z-20 shadow-sm",children:[(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-2 py-1.5 border border-slate-300 text-center w-[60px]",rowSpan:2,children:"병실"}),(0,l.jsx)("th",{className:"px-2 py-1.5 border border-slate-300 text-center w-[80px]",rowSpan:2,children:"환자명"}),(0,l.jsx)("th",{className:"px-1 py-1 border border-slate-300 text-center",colSpan:2,children:"아침"}),(0,l.jsx)("th",{className:"px-1 py-1 border border-slate-300 text-center",colSpan:2,children:"점심"}),(0,l.jsx)("th",{className:"px-1 py-1 border border-slate-300 text-center",colSpan:2,children:"저녁"}),(0,l.jsx)("th",{className:"px-2 py-1.5 border border-slate-300 text-center min-w-[150px]",rowSpan:2,children:"비고"})]}),(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-1 py-1 border border-slate-300 text-center w-[90px] bg-slate-50",children:"환아"}),(0,l.jsx)("th",{className:"px-1 py-1 border border-slate-300 text-center w-[90px] bg-slate-50",children:"보호자"}),(0,l.jsx)("th",{className:"px-1 py-1 border border-slate-300 text-center w-[90px] bg-slate-50",children:"환아"}),(0,l.jsx)("th",{className:"px-1 py-1 border border-slate-300 text-center w-[90px] bg-slate-50",children:"보호자"}),(0,l.jsx)("th",{className:"px-1 py-1 border border-slate-300 text-center w-[90px] bg-slate-50",children:"환아"}),(0,l.jsx)("th",{className:"px-1 py-1 border border-slate-300 text-center w-[90px] bg-slate-50",children:"보호자"})]})]}),(0,l.jsxs)("tbody",{children:[c.map(e=>{var t,s;return(0,l.jsxs)("tr",{className:"hover:bg-blue-50 transition-colors",children:[(0,l.jsx)("td",{className:"px-2 py-1 border border-slate-300 text-center font-bold bg-slate-50",children:e.room}),(0,l.jsx)("td",{className:"px-2 py-1 border border-slate-300 text-center font-bold text-slate-900",children:e.name}),p(e,"BREAKFAST","child"),p(e,"BREAKFAST","guardian"),p(e,"LUNCH","child"),p(e,"LUNCH","guardian"),p(e,"DINNER","child"),p(e,"DINNER","guardian"),(0,l.jsx)("td",{className:"p-0 border border-slate-300 h-[32px]",children:(0,l.jsx)("input",{type:"text",className:"w-full h-full px-2 bg-transparent border-none text-xs focus:ring-inset focus:ring-1 focus:ring-blue-500",placeholder:"-",defaultValue:(null===(s=n[e.id])||void 0===s?void 0:null===(t=s.LUNCH)||void 0===t?void 0:t.room_note)||"",onBlur:t=>{var s,l;let a=(null===(l=n[e.id])||void 0===l?void 0:null===(s=l.LUNCH)||void 0===s?void 0:s.room_note)||"";t.target.value!==a&&u(e,"LUNCH","room_note",t.target.value)}})})]},e.room)}),0===c.length&&(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:9,className:"text-center py-10 text-slate-400 border border-slate-300",children:"입원 중인 환자가 없습니다."})})]})]})})]})}function K(){let{beds:e,setBeds:t,notifications:s,setNotifications:n,lastUploadedIv:i,lastUpdated:o,removeNotification:d}=function(){let[e,t]=(0,a.useState)([]),[s,l]=(0,a.useState)([]),[r,n]=(0,a.useState)(null),[i,o]=(0,a.useState)(Date.now()),d=(0,a.useCallback)(()=>{I.h.get("/api/v1/admissions").then(e=>{Array.isArray(e)&&t(E.map((t,s)=>{let l=e.find(e=>String(e.room_number).trim()===String(t).trim());if(l){var a,r,n;return{id:l.id,room:t,name:l.display_name,token:l.access_token,drops:l.latest_iv?l.latest_iv.infusion_rate:null,temp:null!==(a=l.latest_temp)&&void 0!==a?a:null,had_fever_in_6h:l.had_fever_in_6h,status:null!=l.latest_temp&&l.latest_temp>=38||l.had_fever_in_6h?"fever":"normal",latest_meal:null!==(r=l.latest_meal)&&void 0!==r?r:void 0,last_vital_at:null!==(n=l.last_vital_at)&&void 0!==n?n:void 0,dob:l.dob,gender:l.gender}}return{id:"",room:t,name:"환자".concat(s+1),temp:null,drops:null,status:"normal",token:""}}))}).catch(console.error)},[]);(0,a.useEffect)(()=>{t(E.map((e,t)=>({id:"",room:e,name:"환자".concat(t+1),temp:null,drops:null,status:"normal",token:""}))),d()},[d]);let c=(0,a.useCallback)(e=>{try{let s=JSON.parse(e.data);switch(Math.random().toString(36).substr(2,9),o(Date.now()),s.type){case"NEW_MEAL_REQUEST":if("STATION_UPDATE"===s.data.request_type)break;let a=s.data.pediatric_meal_type,r=s.data.guardian_meal_type,i=a?"".concat(a).concat(r&&"선택 안함"!==r?" / ".concat(r):""):S[s.data.request_type]||s.data.request_type;l(e=>[{id:String(s.data.id),room:s.data.room,time:"방금",content:"식단 신청 (".concat(i,")"),type:"meal",admissionId:s.data.admission_id},...e]),t(e=>e.map(e=>String(e.room)===String(s.data.room)?{...e,latest_meal:{id:Math.floor(1e3*Math.random()),admission_id:s.data.admission_id,request_type:s.data.request_type,pediatric_meal_type:s.data.pediatric_meal_type,guardian_meal_type:s.data.guardian_meal_type,status:"PENDING",created_at:new Date().toISOString(),meal_date:s.data.meal_date,meal_time:s.data.meal_time}}:e));break;case"NEW_DOC_REQUEST":let c=s.data.request_items.map(e=>C[e]||e).join(", ");l(e=>[{id:String(s.data.id),room:s.data.room,time:"방금",content:"서류 신청 (".concat(c,")"),type:"doc",admissionId:s.data.admission_id},...e]);break;case"IV_PHOTO_UPLOADED":n({admissionId:s.data.admission_id,url:s.data.photo_url});break;case"NEW_IV":let x=s.data.infusion_rate,m=s.data.room;t(e=>e.map(e=>String(e.room)===String(m)?{...e,drops:x}:e));break;case"NEW_VITAL":let u=s.data;t(e=>e.map(e=>{if(e.id===u.admission_id){let t=u.temperature>=38;return{...e,temp:u.temperature,last_vital_at:u.recorded_at,had_fever_in_6h:e.had_fever_in_6h||t,status:t||e.had_fever_in_6h?"fever":"normal"}}return e}));break;case"NEW_EXAM_SCHEDULE":case"DELETE_EXAM_SCHEDULE":break;case"ADMISSION_TRANSFERRED":case"ADMISSION_DISCHARGED":d()}}catch(e){console.error("WS Parse Error",e)}},[t,l,o,n,d]),x=Q.env.NEXT_PUBLIC_STATION_WS_TOKEN||"STATION",{isConnected:m}=(0,H.s)({url:"".concat(I.h.getBaseUrl().replace(/^http/,"ws"),"/ws/").concat(x),enabled:!0,onOpen:d,onMessage:c}),u=(0,a.useCallback)(async(e,t,s)=>{if(l(t=>t.filter(t=>t.id!==e)),s&&!isNaN(Number(e)))try{await I.h.patch("/api/v1/".concat("doc"===t?"documents":"meals","/requests/").concat(e,"?status=COMPLETED"),{})}catch(e){console.error("Status Update Failed",e)}},[]);return{beds:e,setBeds:t,notifications:s,setNotifications:l,lastUploadedIv:r,lastUpdated:i,isConnected:m,removeNotification:u}}(),[m,u]=(0,a.useState)(null),[p,b]=(0,a.useState)(null),[h,f]=(0,a.useState)(null),g=async(e,t,s)=>{if(!h)return;let l=t.trim();/^\d{8}$/.test(l)&&(l="".concat(l.substring(0,4),"-").concat(l.substring(4,6),"-").concat(l.substring(6,8)));try{let t=new Date(l),a=new Date,r=a.getFullYear()-t.getFullYear(),n=a.getMonth()-t.getMonth();if((n<0||0===n&&a.getDate()<t.getDate())&&r--,r>=19){alert("만 19세 이상 성인은 입원이 불가능합니다.");return}await I.h.post("/api/v1/admissions",{patient_name:e,room_number:h,dob:l,gender:s}),alert("입원 수속이 완료되었습니다."),f(null);try{window.location.reload()}catch(e){console.error("Reload/Fetch failed",e),alert("목록 조회 중 오류가 발생했습니다. (입원은 정상 처리됨)")}}catch(e){console.error(e),alert("입원 처리 실패: ".concat(e.message||"알 수 없는 오류"))}},j=a.useMemo(()=>m&&e.find(e=>String(e.room)===m)||null,[e,m]),v=t=>{e.find(e=>e.room===t.room)?u(t.room):window.confirm("".concat(t.room,"호 변동사항을 확인하시겠습니까? (환자 정보 없음)"))&&d(t.id)},[y,w]=(0,a.useState)("patients");return(0,l.jsxs)("div",{className:"flex h-screen bg-slate-100 overflow-hidden",children:[(0,l.jsxs)("main",{className:"flex-1 p-2 overflow-y-auto flex flex-col",children:[(0,l.jsxs)("header",{className:"flex justify-between items-center mb-2 px-1 shrink-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("div",{className:"relative h-14 w-32",children:(0,l.jsx)(N.default,{src:"/eco_logo.png",alt:"Eco Pediatrics",fill:!0,className:"object-contain object-left"})}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>w("patients"),className:"px-4 py-2 rounded-lg font-bold transition-colors ".concat("patients"===y?"bg-teal-600 text-white":"bg-white text-slate-600"),children:"환자 리스트"}),(0,l.jsx)("button",{onClick:()=>w("meals"),className:"px-4 py-2 rounded-lg font-bold transition-colors ".concat("meals"===y?"bg-teal-600 text-white":"bg-white text-slate-600"),children:"식단 관리"}),(0,l.jsx)("button",{onClick:async()=>{if(confirm("경고: DEV 모드 전용입니다.\n모든 환자를 퇴원 처리하시겠습니까?"))try{await I.h.post("/api/v1/dev/discharge-all",{}),alert("모든 환자가 퇴원 처리되었습니다."),window.location.reload()}catch(e){alert("Error discharging")}},className:"px-3 py-2 text-xs bg-red-50 text-red-500 border border-red-200 rounded hover:bg-red-100 font-bold ml-2",children:"DEV: 전체퇴원"})]})]}),(0,l.jsxs)("div",{className:"text-slate-500 text-xs",children:["Total: ",e.length]})]}),"patients"===y&&(0,l.jsx)("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-1.5 pb-20",children:e.map(e=>{var t;if(!e.id)return(0,l.jsxs)("div",{className:"h-[140px] border-2 border-dashed border-slate-200 rounded-xl flex flex-col items-center justify-center bg-slate-50/50 hover:bg-slate-50 transition-colors",children:[(0,l.jsx)("div",{className:"text-lg font-bold text-slate-400 mb-2",children:e.room}),(0,l.jsx)("button",{onClick:()=>f(e.room),className:"px-3 py-1.5 bg-teal-600 text-white text-xs font-bold rounded-lg hover:bg-teal-700",children:"입원"})]},e.room);let s=e.had_fever_in_6h||null!==e.temp&&e.temp>=38;return(0,l.jsx)(c,{name:e.name,roomNumber:e.room,temperature:null!==e.temp?e.temp.toFixed(1):"-",infusionRate:null!==(t=e.drops)&&void 0!==t?t:"-",status:s?"fever":"normal",onCardClick:()=>u(e.room),onQrClick:t=>{t.stopPropagation(),e.token?b(e):alert("토큰 없음")},dob:e.dob,gender:e.gender},e.room)})}),"meals"===y&&(0,l.jsx)("div",{className:"flex-1 overflow-hidden p-1",children:(0,l.jsx)(B,{beds:e})})]}),(0,l.jsxs)("aside",{className:"w-80 bg-white border-l border-slate-200 p-4 flex flex-col gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2 text-slate-800 font-semibold",children:[(0,l.jsx)(x.Z,{size:20,className:"text-teal-500"}),(0,l.jsx)("span",{children:"Recent Requests"})]}),(0,l.jsx)("div",{className:"flex flex-col gap-3 overflow-y-auto pr-1 flex-1",children:s.map(e=>(0,l.jsxs)(r.Z,{className:"border-l-4 cursor-pointer hover:bg-slate-50 transition-colors ".concat("meal"===e.type?"border-l-orange-500":"border-l-blue-500"),onClick:()=>v(e),children:[(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("span",{className:"font-bold text-slate-700",children:[e.room,"호"]}),(0,l.jsx)("span",{className:"text-xs text-slate-400",children:e.time})]}),(0,l.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:e.content})]},e.id))})]}),j&&(0,l.jsx)(F,{isOpen:!!m,onClose:()=>u(null),bed:j,notifications:s,onCompleteRequest:(e,t,s)=>d(e,t,s),lastUploadedIv:i,onIVUploadSuccess:e=>{void 0!==e&&m&&t(t=>t.map(t=>String(t.room)===m?{...t,drops:e}:t))},onVitalUpdate:e=>{m&&t(t=>t.map(t=>String(t.room)===m?{...t,temp:e,last_vital_at:new Date().toISOString(),status:e>=38||t.had_fever_in_6h?"fever":"normal"}:t))},lastUpdated:o}),p&&(0,l.jsx)(q,{isOpen:!!p,onClose:()=>b(null),patientName:p.name,roomNumber:p.room,token:p.token}),(0,l.jsx)(V,{isOpen:!!h,onClose:()=>f(null),roomNumber:h||"",onAdmit:g})]})}}},function(e){e.O(0,[38,360,613,135,971,117,744],function(){return e(e.s=7420)}),_N_E=e.O()}]);